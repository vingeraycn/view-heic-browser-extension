# HEIC 扩展测试指南

## 🎯 测试目标

本测试页面旨在验证改进版 HEIC 浏览器扩展的以下功能：

- HEIC 图片自动转换
- 不同文件大小的处理性能
- 错误处理和用户反馈
- 动态加载图片的监听
- 内存管理和资源清理

## 📂 测试文件说明

我们准备了 4 个不同的本地 HEIC 测试文件：

| 文件名                | 大小  | 说明           | 预期结果                |
| --------------------- | ----- | -------------- | ----------------------- |
| `example.heic`        | 1.1MB | 原始大文件     | ✅ 正常转换（测试性能） |
| `small-test.heic`     | 873KB | Nokia 标准文件 | ✅ 正常转换（标准格式） |
| `medium-test.heic`    | 219KB | 小文件         | ✅ 快速转换             |
| `corrupted-test.heic` | 78B   | 损坏文件       | ❌ 显示错误提示         |

## 🚀 如何测试

### 1. 启动本地服务器

```bash
# 方法1：使用pnpm脚本
pnpm run test:server

# 方法2：使用Python
python3 -m http.server 8080 --bind 127.0.0.1 --directory docs

# 方法3：使用Node.js服务器
node test-server.js
```

### 2. 加载浏览器扩展

1. 构建扩展：`pnpm build`
2. 打开 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `.output/chrome-mv3` 文件夹

### 3. 访问测试页面

打开浏览器访问：**http://127.0.0.1:8080/test-improved.html**

## ✅ 测试检查清单

### 基础功能测试

- [ ] 扩展状态显示"正常"
- [ ] 大文件 (1.1MB) 能正常转换
- [ ] 标准文件 (873KB) 能正常转换
- [ ] 小文件 (219KB) 能快速转换
- [ ] 损坏文件 (78B) 显示错误提示

### 状态反馈测试

- [ ] 转换中显示 🔄 转换中...
- [ ] 转换成功图片正常显示
- [ ] 转换失败显示红色虚线边框
- [ ] 鼠标悬停显示错误详情
- [ ] 点击失败图片可查看原图

### 动态加载测试

- [ ] 点击"添加动态 HEIC 图片"按钮
- [ ] 循环添加不同类型的测试文件
- [ ] DOM 监听正常工作
- [ ] 转换统计实时更新

### 性能和资源管理

- [ ] 不会重复处理同一张图片
- [ ] 并发处理数量受限（最多 3 张）
- [ ] 控制台显示详细处理日志
- [ ] 页面刷新后资源正确清理

## 🔍 问题排查

### 如果扩展状态显示"未检测到"

1. 确认扩展已正确加载并启用
2. 检查控制台是否有 JavaScript 错误
3. 确认访问的是 HTTP 地址（不是 file://）

### 如果图片无法转换

1. 检查控制台中的错误日志
2. 确认 HEIC 文件确实存在于 docs 目录
3. 检查网络面板中的文件请求状态

### 如果页面无法访问

1. 确认本地服务器正在运行
2. 检查 8080 端口是否被占用
3. 尝试使用不同的端口号

## 📊 预期测试结果

正常情况下应该看到：

- **成功转换**: 3 张图片（1.1MB、873KB、219KB）
- **转换失败**: 1 张图片（78B 损坏文件）
- **总计处理**: 4 张图片
- **错误类型**: 格式错误

## 🛠️ 本地文件的优势

相比使用远程文件：

- ✅ **无 CORS 问题**：避免跨域访问限制
- ✅ **稳定可靠**：不依赖外部网络连接
- ✅ **测试完整**：涵盖各种大小和格式场景
- ✅ **开发友好**：完全本地化，便于调试
- ✅ **离线工作**：无需互联网连接

## 🎉 总结

这套本地测试环境提供了完整、稳定、无 CORS 问题的 HEIC 扩展功能验证方案，是开发和测试的理想选择。
