<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ”¹è¿›ç‰ˆHEICæ‰©å±•æµ‹è¯•é¡µé¢</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        background: white;
        margin-bottom: 20px;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-section h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #007aff;
        padding-bottom: 10px;
      }
      .image-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      .image-item {
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        background: #f9f9f9;
      }
      .image-item img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        display: block;
      }
      .image-info {
        padding: 10px;
        font-size: 14px;
        color: #666;
      }
      .status-indicator {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
      }
      .status-loading {
        background: #fff3cd;
        color: #856404;
      }
      .status-success {
        background: #d4edda;
        color: #155724;
      }
      .status-error {
        background: #f8d7da;
        color: #721c24;
      }
      .improvement-list {
        list-style: none;
        padding: 0;
      }
      .improvement-list li {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }
      .improvement-list li:before {
        content: "âœ…";
        margin-right: 10px;
      }
      .dynamic-test {
        margin-top: 20px;
        padding: 15px;
        background: #e3f2fd;
        border-radius: 6px;
      }
      .add-image-btn {
        background: #007aff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      .add-image-btn:hover {
        background: #0056cc;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ–¼ï¸ View HEIC æ‰©å±• - æ”¹è¿›ç‰ˆæµ‹è¯•</h1>
      <p>æµ‹è¯•æ”¹è¿›åçš„HEICå›¾ç‰‡è½¬æ¢åŠŸèƒ½</p>
      <div id="extension-status">
        <span id="status-text">æ£€æµ‹æ‰©å±•çŠ¶æ€ä¸­...</span>
        <span id="status-indicator" class="status-indicator status-loading">æ£€æµ‹ä¸­</span>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸš€ ä¸»è¦æ”¹è¿›ç‚¹</h3>
      <ul class="improvement-list">
        <li>å‡çº§åˆ° heic-to@1.2.1 åº“ï¼ˆåŸºäºæœ€æ–° libheif 1.20.1ï¼‰</li>
        <li>ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ·»åŠ èµ„æºæ¸…ç†</li>
        <li>é¿å…é‡å¤å¤„ç†åŒä¸€å›¾ç‰‡</li>
        <li>é™åˆ¶å¹¶å‘å¤„ç†æ•°é‡ï¼Œæå‡æ€§èƒ½</li>
        <li>å¢å¼ºé”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º</li>
        <li>æ·»åŠ 50MBæ–‡ä»¶å¤§å°é™åˆ¶</li>
        <li>æ›´ç²¾å‡†çš„DOMç›‘å¬æœºåˆ¶</li>
        <li>æ¨¡å—åŒ–ä»£ç æ¶æ„</li>
      </ul>
    </div>

    <div class="test-section">
      <h3>ğŸ“· HEICå›¾ç‰‡è½¬æ¢æµ‹è¯•</h3>
      <p>æµ‹è¯•é¡µé¢åŠ è½½æ—¶çš„HEICå›¾ç‰‡å¤„ç†ï¼ˆä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œé¿å…CORSé—®é¢˜ï¼‰ï¼š</p>
      <div class="image-grid">
        <div class="image-item">
          <img src="./example.heic" alt="å¤§æ–‡ä»¶HEICæµ‹è¯•" />
          <div class="image-info">
            <strong>å¤§æ–‡ä»¶æµ‹è¯•</strong><br />
            æ–‡ä»¶: example.heic (1.1MB)<br />
            <small>âœ… æµ‹è¯•å¤§æ–‡ä»¶è½¬æ¢æ€§èƒ½</small>
          </div>
        </div>
        <div class="image-item">
          <img src="./small-test.heic" alt="æ ‡å‡†HEICæµ‹è¯•" />
          <div class="image-info">
            <strong>æ ‡å‡†HEICæ–‡ä»¶</strong><br />
            æ–‡ä»¶: small-test.heic (873KB)<br />
            <small>âœ… Nokiaæ ‡å‡†æµ‹è¯•æ–‡ä»¶</small>
          </div>
        </div>
        <div class="image-item">
          <img src="./medium-test.heic" alt="å°æ–‡ä»¶HEICæµ‹è¯•" />
          <div class="image-info">
            <strong>å°æ–‡ä»¶æµ‹è¯•</strong><br />
            æ–‡ä»¶: medium-test.heic (219KB)<br />
            <small>âœ… æµ‹è¯•å°æ–‡ä»¶å¿«é€Ÿè½¬æ¢</small>
          </div>
        </div>
        <div class="image-item">
          <img src="./corrupted-test.heic" alt="æŸåæ–‡ä»¶æµ‹è¯•" />
          <div class="image-info">
            <strong>é”™è¯¯å¤„ç†æµ‹è¯•</strong><br />
            æ–‡ä»¶: corrupted-test.heic (78B)<br />
            <small>âŒ æµ‹è¯•æ ¼å¼é”™è¯¯å¤„ç†</small>
          </div>
        </div>
      </div>

      <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 6px; font-size: 14px">
        <strong>âœ… æœ¬åœ°æ–‡ä»¶æµ‹è¯•ä¼˜åŠ¿ï¼š</strong><br />
        â€¢ <strong>æ— CORSé—®é¢˜</strong>ï¼šæ‰€æœ‰æ–‡ä»¶éƒ½é€šè¿‡æœ¬åœ°HTTPæœåŠ¡å™¨è®¿é—®<br />
        â€¢ <strong>ç¨³å®šå¯é </strong>ï¼šä¸ä¾èµ–å¤–éƒ¨ç½‘ç»œï¼Œæµ‹è¯•ç»“æœä¸€è‡´<br />
        â€¢ <strong>å…¨é¢è¦†ç›–</strong>ï¼šåŒ…å«ä¸åŒå¤§å°å’Œæ ¼å¼çš„æµ‹è¯•åœºæ™¯<br />
        â€¢ <strong>ç¦»çº¿æµ‹è¯•</strong>ï¼šå®Œå…¨æœ¬åœ°åŒ–ï¼Œå¼€å‘æ—¶æ›´æ–¹ä¾¿
      </div>

      <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; font-size: 14px">
        <strong>ğŸ“Š æµ‹è¯•æ–‡ä»¶è¯´æ˜ï¼š</strong><br />
        â€¢ <strong>å¤§æ–‡ä»¶</strong> (1.1MB)ï¼šæµ‹è¯•æ€§èƒ½å’Œå†…å­˜ç®¡ç†<br />
        â€¢ <strong>æ ‡å‡†æ–‡ä»¶</strong> (873KB)ï¼šNokiaå®˜æ–¹æµ‹è¯•æ–‡ä»¶ï¼Œæ ‡å‡†HEICæ ¼å¼<br />
        â€¢ <strong>å°æ–‡ä»¶</strong> (219KB)ï¼šæµ‹è¯•å¿«é€Ÿè½¬æ¢å’Œå¹¶å‘å¤„ç†<br />
        â€¢ <strong>æŸåæ–‡ä»¶</strong> (78B)ï¼šæµ‹è¯•é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ”„ åŠ¨æ€åŠ è½½æµ‹è¯•</h3>
      <p>æµ‹è¯•DOMå˜åŒ–ç›‘å¬å’ŒåŠ¨æ€å›¾ç‰‡å¤„ç†ï¼š</p>
      <div class="dynamic-test">
        <button class="add-image-btn" onclick="addDynamicImage()">æ·»åŠ åŠ¨æ€HEICå›¾ç‰‡</button>
        <div id="dynamic-images" class="image-grid" style="margin-top: 15px"></div>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ“Š è½¬æ¢ç»Ÿè®¡</h3>
      <div id="conversion-stats">
        <p>æˆåŠŸè½¬æ¢: <span id="success-count">0</span></p>
        <p>è½¬æ¢å¤±è´¥: <span id="failure-count">0</span></p>
        <p>æ€»è®¡å¤„ç†: <span id="total-count">0</span></p>
      </div>
    </div>

    <script>
      let imageCount = 0

      // æ£€æµ‹æ‰©å±•çŠ¶æ€
      function checkExtensionStatus() {
        const statusText = document.getElementById("status-text")
        const statusIndicator = document.getElementById("status-indicator")

        // é€šè¿‡æ£€æŸ¥æ˜¯å¦æœ‰HEICå¤„ç†ç›¸å…³çš„ç±»åæ¥åˆ¤æ–­æ‰©å±•æ˜¯å¦å·¥ä½œ
        setTimeout(() => {
          const heicImages = document.querySelectorAll('img[src$=".heic"], img[src$=".HEIC"]')
          let hasProcessed = false

          heicImages.forEach((img) => {
            if (
              img.classList.contains("heic-converted") ||
              img.classList.contains("heic-processing") ||
              img.classList.contains("heic-error")
            ) {
              hasProcessed = true
            }
          })

          if (hasProcessed) {
            statusText.textContent = "æ‰©å±•è¿è¡Œæ­£å¸¸"
            statusIndicator.textContent = "æ­£å¸¸"
            statusIndicator.className = "status-indicator status-success"
          } else {
            statusText.textContent = "æœªæ£€æµ‹åˆ°æ‰©å±•æ´»åŠ¨"
            statusIndicator.textContent = "æœªæ£€æµ‹åˆ°"
            statusIndicator.className = "status-indicator status-error"
          }
        }, 2000)
      }

      // æ·»åŠ åŠ¨æ€å›¾ç‰‡
      function addDynamicImage() {
        imageCount++
        const container = document.getElementById("dynamic-images")
        const imageItem = document.createElement("div")
        imageItem.className = "image-item"

        // æµ‹è¯•ç”¨ä¾‹ï¼šå¾ªç¯ä½¿ç”¨ä¸åŒçš„æœ¬åœ°æµ‹è¯•æ–‡ä»¶
        const testCases = [
          {
            src: "./example.heic",
            name: "å¤§æ–‡ä»¶æµ‹è¯•",
            description: "1.1MBæ–‡ä»¶è½¬æ¢æµ‹è¯•",
          },
          {
            src: "./small-test.heic",
            name: "æ ‡å‡†æ–‡ä»¶æµ‹è¯•",
            description: "Nokiaæ ‡å‡†HEICæ–‡ä»¶",
          },
          {
            src: "./medium-test.heic",
            name: "å°æ–‡ä»¶æµ‹è¯•",
            description: "å¿«é€Ÿè½¬æ¢æµ‹è¯•",
          },
          {
            src: "./corrupted-test.heic",
            name: "é”™è¯¯å¤„ç†æµ‹è¯•",
            description: "æŸåæ–‡ä»¶æ ¼å¼æµ‹è¯•",
          },
        ]

        const testCase = testCases[(imageCount - 1) % testCases.length]

        imageItem.innerHTML = `
                <img src="${testCase.src}" alt="åŠ¨æ€HEICå›¾ç‰‡ ${imageCount}">
                <div class="image-info">
                    <strong>åŠ¨æ€å›¾ç‰‡ #${imageCount}</strong><br>
                    ç±»å‹: ${testCase.name}<br>
                    ${testCase.description}<br>
                    <small>æ·»åŠ æ—¶é—´: ${new Date().toLocaleTimeString()}</small>
                </div>
            `
        container.appendChild(imageItem)

        // æ›´æ–°ç»Ÿè®¡
        updateStats()
      }

      // æ›´æ–°è½¬æ¢ç»Ÿè®¡
      function updateStats() {
        setTimeout(() => {
          const allImages = document.querySelectorAll('img[src$=".heic"], img[src$=".HEIC"]')
          const successImages = document.querySelectorAll("img.heic-converted")
          const errorImages = document.querySelectorAll("img.heic-error")

          document.getElementById("total-count").textContent = allImages.length
          document.getElementById("success-count").textContent = successImages.length
          document.getElementById("failure-count").textContent = errorImages.length
        }, 1000)
      }

      // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
      document.addEventListener("DOMContentLoaded", () => {
        checkExtensionStatus()
        updateStats()

        // å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        setInterval(updateStats, 3000)
      })
    </script>
  </body>
</html>
